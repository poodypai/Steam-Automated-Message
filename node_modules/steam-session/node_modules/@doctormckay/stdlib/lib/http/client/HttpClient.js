"use strict";
var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {
    if (kind === "m") throw new TypeError("Private method is not writable");
    if (kind === "a" && !f) throw new TypeError("Private accessor was defined without a setter");
    if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot write private member to an object whose class did not declare it");
    return (kind === "a" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;
};
var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {
    if (kind === "a" && !f) throw new TypeError("Private accessor was defined without a getter");
    if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
    return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _HttpClient_instances, _HttpClient_httpAgent, _HttpClient_httpsAgent, _HttpClient_localAddress, _HttpClient_defaultHeaders, _HttpClient_defaultTimeout, _HttpClient_gzip, _HttpClient_decodeRequestOptions;
Object.defineProperty(exports, "__esModule", { value: true });
exports.preProcessOptions = void 0;
const events_1 = require("events");
const http_1 = require("http");
const https_1 = require("https");
const querystring_1 = require("querystring");
const zlib_1 = require("zlib");
const objects_1 = require("../../../objects");
const promises_1 = require("../../../promises");
const CookieJar_1 = __importDefault(require("./CookieJar"));
const crypto_1 = require("crypto");
const BODY_TYPES = ['body', 'urlEncodedForm', 'multipartForm', 'json'];
const METHODS_WITHOUT_BODY = ['GET', 'HEAD', 'OPTIONS', 'TRACE'];
const UTF8_PARSEABLE_CONTENT_TYPES = [
    // text/* is always considered parseable
    'application/json',
    'application/x-www-form-urlencoded',
    'application/xml',
    'application/xhtml+xml',
    'message/http' // for TRACE responses
];
const REDIRECT_STATUS_CODES = [301, 302, 303, 307, 308];
class HttpClient extends events_1.EventEmitter {
    constructor(options) {
        super();
        _HttpClient_instances.add(this);
        _HttpClient_httpAgent.set(this, void 0);
        _HttpClient_httpsAgent.set(this, void 0);
        _HttpClient_localAddress.set(this, void 0);
        _HttpClient_defaultHeaders.set(this, void 0);
        _HttpClient_defaultTimeout.set(this, void 0);
        _HttpClient_gzip.set(this, void 0);
        options = options || {};
        this.userAgent = options.userAgent;
        __classPrivateFieldSet(this, _HttpClient_httpAgent, options.httpAgent || new http_1.Agent({ keepAlive: true }), "f");
        __classPrivateFieldSet(this, _HttpClient_httpsAgent, options.httpsAgent || new https_1.Agent({ keepAlive: true }), "f");
        __classPrivateFieldSet(this, _HttpClient_localAddress, options.localAddress, "f");
        __classPrivateFieldSet(this, _HttpClient_defaultHeaders, normalizeHeadersObject(options.defaultHeaders || {}), "f");
        __classPrivateFieldSet(this, _HttpClient_defaultTimeout, options.defaultTimeout || 0, "f");
        __classPrivateFieldSet(this, _HttpClient_gzip, options.gzip !== false, "f");
        if (options.cookieJar) {
            this.cookieJar = options.cookieJar === true ? new CookieJar_1.default() : options.cookieJar;
        }
    }
    request(options) {
        let timeout = options.timeout || __classPrivateFieldGet(this, _HttpClient_defaultTimeout, "f") || 0;
        return (0, promises_1.timeoutPromise)(timeout, (resolve, reject) => {
            options = preProcessOptions(options);
            createRequestBody(options);
            let nodeOptions = __classPrivateFieldGet(this, _HttpClient_instances, "m", _HttpClient_decodeRequestOptions).call(this, options);
            let reqFunc = nodeOptions.protocol == 'http:' ? http_1.request : https_1.request;
            this.emit('debug', 'request', `${nodeOptions.method} ${buildUrl(nodeOptions)}`, nodeOptions.headers);
            let req = reqFunc(nodeOptions, (res) => {
                let bodyChunks = [];
                let responseStream = res;
                if (res.headers['content-encoding'] == 'gzip') {
                    this.emit('debug', 'decompressing gzipped response');
                    let gzipStream = (0, zlib_1.createGunzip)();
                    responseStream.pipe(gzipStream);
                    responseStream = gzipStream;
                }
                responseStream.on('data', chunk => bodyChunks.push(chunk));
                responseStream.on('end', () => {
                    let response = {
                        statusCode: res.statusCode,
                        statusMessage: res.statusMessage,
                        url: buildUrl(nodeOptions),
                        headers: res.headers,
                        rawBody: Buffer.concat(bodyChunks)
                    };
                    this.emit('debug', 'response', `${nodeOptions.method} ${buildUrl(nodeOptions)} ${res.statusCode} ${res.statusMessage} ${res.headers['content-type']}`);
                    if (this.cookieJar) {
                        let setCookieHeader = response.headers['set-cookie'] || [];
                        if (!Array.isArray(setCookieHeader)) {
                            setCookieHeader = [setCookieHeader];
                        }
                        setCookieHeader.forEach((setCookie) => {
                            this.cookieJar.add(setCookie, nodeOptions.host);
                        });
                    }
                    let contentType = (res.headers['content-type'] || '').split(';')[0].trim();
                    if (contentType.startsWith('text/') || UTF8_PARSEABLE_CONTENT_TYPES.includes(contentType)) {
                        response.textBody = response.rawBody.toString('utf8');
                    }
                    if (contentType == 'application/json') {
                        try {
                            response.jsonBody = JSON.parse(response.textBody);
                        }
                        catch (ex) {
                            // don't care
                        }
                    }
                    if (options.followRedirects && REDIRECT_STATUS_CODES.includes(res.statusCode) && res.headers.location) {
                        let newRequest = (0, objects_1.clone)(options);
                        if ([301, 302, 303].includes(res.statusCode)) {
                            // Change the method to GET
                            newRequest.method = 'GET';
                            newRequest.url = res.headers.location;
                            delete newRequest.body;
                            delete newRequest.headers['content-type'];
                            delete newRequest.headers['content-length'];
                            this.request(newRequest).then(resolve).catch(reject);
                            return;
                        }
                    }
                    resolve(response);
                });
                res.on('error', reject);
            });
            req.end(options.body);
            req.on('error', reject);
        });
    }
    static simpleObjectToMultipartForm(obj) {
        let multipartForm = {};
        for (let i in obj) {
            multipartForm[i] = { content: obj[i] };
        }
        return multipartForm;
    }
}
exports.default = HttpClient;
_HttpClient_httpAgent = new WeakMap(), _HttpClient_httpsAgent = new WeakMap(), _HttpClient_localAddress = new WeakMap(), _HttpClient_defaultHeaders = new WeakMap(), _HttpClient_defaultTimeout = new WeakMap(), _HttpClient_gzip = new WeakMap(), _HttpClient_instances = new WeakSet(), _HttpClient_decodeRequestOptions = function _HttpClient_decodeRequestOptions(options) {
    let nodeOptions = {};
    let url = new URL(options.url);
    let queryString = url.search;
    if (options.queryString) {
        if (queryString.length == 0) {
            queryString += '?';
        }
        if (!queryString.endsWith('?')) {
            // If the final character of our query string isn't "?", then we need to append a "&" to separate our new
            // options from existing options.
            queryString += '&';
        }
        queryString += (0, querystring_1.stringify)(options.queryString);
    }
    nodeOptions.protocol = url.protocol;
    nodeOptions.host = url.hostname;
    nodeOptions.port = getPort(url.port, url.protocol);
    nodeOptions.path = url.pathname + queryString;
    nodeOptions.method = options.method;
    nodeOptions.agent = url.protocol == 'http:' ? __classPrivateFieldGet(this, _HttpClient_httpAgent, "f") : __classPrivateFieldGet(this, _HttpClient_httpsAgent, "f");
    nodeOptions.localAddress = __classPrivateFieldGet(this, _HttpClient_localAddress, "f");
    nodeOptions.headers = {
        ...({ 'user-agent': this.userAgent }),
        ...__classPrivateFieldGet(this, _HttpClient_defaultHeaders, "f"),
        ...(options.headers || {})
    };
    if (this.cookieJar) {
        let cookieHeaderValue = this.cookieJar.getCookieHeaderForUrl(options.url);
        if (cookieHeaderValue.length > 0) {
            let existingCookieHeader = options.headers.cookie;
            nodeOptions.headers.cookie = (existingCookieHeader ? `${existingCookieHeader}; ` : '') + cookieHeaderValue;
        }
    }
    if (__classPrivateFieldGet(this, _HttpClient_gzip, "f")) {
        nodeOptions.headers['accept-encoding'] = 'gzip';
    }
    for (let i in nodeOptions.headers) {
        // remove undefined values from headers
        if (typeof nodeOptions.headers[i] == 'undefined') {
            delete nodeOptions.headers[i];
        }
    }
    return nodeOptions;
};
function getPort(portStr, protocol) {
    let port = parseInt(portStr);
    if (isNaN(port) || port == 0) {
        return protocol == 'http:' ? 80 : 443;
    }
    return port;
}
function preProcessOptions(options) {
    // deep-clone the object so we don't cause any problems with implementation code
    options = (0, objects_1.clone)(options);
    options.method = options.method.toUpperCase();
    options.headers = options.headers || {};
    // lowercase all the header names
    options.headers = normalizeHeadersObject(options.headers);
    // Only 1 body type may be specified. If more than 1 is present, that's an error.
    if (BODY_TYPES.filter(bt => typeof options[bt] != 'undefined').length > 1) {
        throw new Error('Multiple body types were specified. Only 1 of body, urlEncodedForm, multipartForm, json may be specified');
    }
    return options;
}
exports.preProcessOptions = preProcessOptions;
function createRequestBody(options) {
    let bodyBuffer = Buffer.alloc(0);
    if (options.body) {
        bodyBuffer = Buffer.isBuffer(options.body) ? options.body : Buffer.from(options.body, 'utf8');
    }
    if (options.urlEncodedForm) {
        bodyBuffer = Buffer.from((0, querystring_1.stringify)(options.urlEncodedForm), 'utf8');
        options.headers['content-type'] = 'application/x-www-form-urlencoded';
    }
    if (options.json) {
        bodyBuffer = Buffer.from(JSON.stringify(options.json), 'utf8');
        options.headers['content-type'] = 'application/json';
    }
    if (options.multipartForm) {
        let boundary = '-----------------------------' + (0, crypto_1.randomBytes)(20).toString('hex');
        options.headers['content-type'] = `multipart/form-data; boundary=${boundary}`;
        let encodedBodyParts = [];
        for (let i in options.multipartForm) {
            let formObject = options.multipartForm[i];
            let head = `--${boundary}\r\nContent-Disposition: form-data; name="${i}"` +
                (formObject.filename ? `; filename="${formObject.filename}"` : '') +
                (formObject.contentType ? `\r\nContent-Type: ${formObject.contentType}` : '') +
                '\r\n\r\n';
            let tail = '\r\n';
            encodedBodyParts = encodedBodyParts.concat([
                Buffer.from(head, 'utf8'),
                Buffer.isBuffer(formObject.content) ? formObject.content : Buffer.from(formObject.content, 'utf8'),
                Buffer.from(tail, 'utf8')
            ]);
        }
        encodedBodyParts.push(Buffer.from(`--${boundary}--\r\n`, 'utf8'));
        bodyBuffer = Buffer.concat(encodedBodyParts);
    }
    if (METHODS_WITHOUT_BODY.includes(options.method)) {
        if (bodyBuffer.length > 0) {
            throw new Error(`Requests with method "${options.method}" may not have a request body`);
        }
        delete options.headers['content-type'];
        delete options.headers['content-length'];
        return;
    }
    delete options.urlEncodedForm;
    delete options.json;
    delete options.multipartForm;
    options.body = bodyBuffer;
    options.headers['content-length'] = options.body.length;
}
function buildUrl(urlObj) {
    let portAppend = (urlObj.protocol == 'http:' && urlObj.port != 80) ||
        (urlObj.protocol == 'https:' && urlObj.port != 443);
    return `${urlObj.protocol}//${urlObj.host}${portAppend ? `:${urlObj.port}` : ''}${urlObj.path}`;
}
function normalizeHeadersObject(headersObj) {
    headersObj = headersObj || {};
    let normalizedHeaders = {};
    for (let i in headersObj) {
        let nameLower = i.toLowerCase();
        if (normalizedHeaders[nameLower]) {
            throw new Error(`Header "${nameLower}" appears in the headers object multiple times, with different capitalization`);
        }
        normalizedHeaders[nameLower] = headersObj[i];
    }
    return normalizedHeaders;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSHR0cENsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvaHR0cC9jbGllbnQvSHR0cENsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxtQ0FBb0M7QUFDcEMsK0JBQXNHO0FBQ3RHLGlDQUFtRTtBQUNuRSw2Q0FBMkQ7QUFDM0QsK0JBQWtDO0FBR2xDLDhDQUF1QztBQUN2QyxnREFBaUQ7QUFDakQsNERBQW9DO0FBRXBDLG1DQUFtQztBQUVuQyxNQUFNLFVBQVUsR0FBRyxDQUFDLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdkUsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ2pFLE1BQU0sNEJBQTRCLEdBQUc7SUFDcEMsd0NBQXdDO0lBQ3hDLGtCQUFrQjtJQUNsQixtQ0FBbUM7SUFDbkMsaUJBQWlCO0lBQ2pCLHVCQUF1QjtJQUN2QixjQUFjLENBQUMsc0JBQXNCO0NBQ3JDLENBQUM7QUFDRixNQUFNLHFCQUFxQixHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBRXhELE1BQXFCLFVBQVcsU0FBUSxxQkFBWTtJQVduRCxZQUFZLE9BQTJCO1FBQ3RDLEtBQUssRUFBRSxDQUFDOztRQVJULHdDQUFzQjtRQUN0Qix5Q0FBd0I7UUFDeEIsMkNBQXVCO1FBQ3ZCLDZDQUFpRDtRQUNqRCw2Q0FBd0I7UUFDeEIsbUNBQWU7UUFLZCxPQUFPLEdBQUcsT0FBTyxJQUFJLEVBQUUsQ0FBQztRQUV4QixJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7UUFDbkMsdUJBQUEsSUFBSSx5QkFBYyxPQUFPLENBQUMsU0FBUyxJQUFJLElBQUksWUFBUyxDQUFDLEVB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